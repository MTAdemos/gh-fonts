% Walsh01 -- modelled on Walsh, for Handel Water music
%

/Base-Music27m11 findfont dup maxlength 4 add dict begin
{1 index/FID ne{def}{pop pop}ifelse}forall

/nBBox 15 dict def
/nMetrics 15 dict def
/nVMetrics 15 dict def
/nCharacterDefs 15 dict def

/IntProcs 10 dict def

IntProcs begin
  % lower upper random --- returns random numberbetween lower and uupper
  /random{
    /upper exch def
    /lower exch def
    /random_max 2 31 exp 1 sub def

    rand random_max div            % random number  0 -> 1
    upper lower sub mul            % random number  0 -> (upper-lower)
    lower add                      % random number  lower -> upper
  }bind def
end % IntProcs

/StemWidth 60 def
% break pointer to encoding

/Encoding Encoding aload length array astore def
Encoding 1 /direct put

% add new FontName

/FontName/Walsh01 def

% add revised versions

/CentreAdjust{
  systemdict/languagelevel known{
    gsave
      true setstrokeadjust
      -250 200 moveto 40 setlinewidth 500 0 rlineto
      200 0.5 300{0 1 index instroke{pop}{exit}ifelse}for   % top of adjusted line
      200 -0.5 100{0 1 index instroke{pop}{exit}ifelse}for % bottom of adjusted line
    grestore
    newpath
    add 2 div 200 sub neg 0 exch translate            % now centre of char is
  }if                                                 % adjusted to centre of
}bind def


/cnh{
  601 345 moveto
  IntProcs begin
    /savectm matrix currentmatrix def
    377 64 moveto
    306 -9 203 -17 133 56 curveto
    69 121 70 250 161 339 curveto
    242 411 338 417 408 344 curveto
    485 267 464 152 377 64 curveto
    closepath
  end
}bind def

/dqtail{
 80 setlinewidth
 gsave
   84 StemWidth 2 div add 10 add 150 translate
   0 -1200 moveto 300 700 rlineto stroke
 grestore
}bind def


/dsqtail{
 80 setlinewidth
 gsave
   84 StemWidth 2 div add 10 add 150 translate
   2{0 -1200 moveto 300 450 rlineto stroke 0 400 translate}repeat
 grestore
}bind def


/dstem{
  84 StemWidth 2 div add 150 moveto
  systemdict/languagelevel known{true setstrokeadjust}{currentpoint .onround moveto}ifelse
  1 setlinecap
  0 -1200 Rl StemWidth setlinewidth stroke
}bind def

/uqtail{
 80 setlinewidth
 gsave
   460 StemWidth 2 div sub 10 add 250 2400 add translate
   0 -1200 moveto 300 -700 rlineto stroke
 grestore
}bind def


/usqtail{
 80 setlinewidth
 gsave
   460 StemWidth 2 div sub 10 add 250 2400 add translate
   2{0 -1200 moveto 300 -450 rlineto stroke 0 -400 translate}repeat
 grestore
}bind def

/ustem{
  460 StemWidth 2 div sub 250 moveto
  systemdict/languagelevel known{true setstrokeadjust}{currentpoint .onround moveto}ifelse
  1 setlinecap
  0 1200 Rl StemWidth setlinewidth stroke
}bind def

/stave{
  IntProcs begin
    /staffl exch def
    true setstrokeadjust 50 setlinewidth
    0    0 Pm staffl 0 60 random add 0 rlineto stroke
    0  400 Pm staffl 0 60 random add 0 rlineto stroke
    0  800 Pm staffl 0 60 random add 0 rlineto stroke
    0 1200 Pm staffl 0 60 random add 0 rlineto stroke
    0 1600 Pm staffl 0 60 random add 0 rlineto stroke
  end
}bind def

/LocalDict 10 dict dup/DictName 3 index put def
LocalDict begin
 /a 0 def
 /b 0 def
 /DefaultBottomUp 100 def
 /BottomUp DefaultBottomUp def
end

% new cnh, mnh & bnh here


nBBox begin
  /direct{-1000 0 1000 1000}def
  /flat{10 -100 515 872}def
end % nBBox

nMetrics begin
  /direct 0 def
  /ucrotchet 650 def
  /dcrotchet 650 def
  /dquaver 650 def
  /dsquaver 650 def
  /uquaver 650 def
  /usquaver 650 def
end % nMetrics

nVMetrics begin
end % nVMetrics

nCharacterDefs begin
  /direct{
    -200 -4595 translate
    18 dup scale
19.42 273.60 moveto
20.49 269.52 21.25 269.71 21.14 259.08 curveto
24.22 268.45 27.20 269.71 29.14 272.22 curveto
30.74 269.48 32.34 268.34 34.05 259.20 curveto
38.05 279.54 45.81 293.94 50.97 290.05 curveto
    3 setlinewidth 1 setlinecap 1 setlinejoin stroke
  }bind def


  /crest{
    1 setlinecap 90 setlinewidth
    420 620 moveto
    100 610 lineto
    140 140 lineto stroke
  }bind def


  /flat{
    -130  -772 translate
    8 dup scale
    0.8 1 scale

    64.19 179.60 14 add moveto
    66 152.80 7 add 64.19 122.80 66.59 104 curveto
    67.59 97.59 76 97.19 82.19 102.40 curveto
    89.19 107 92.80 112.40 93 117.60 curveto
    93 131 83.59 138 76.80 141.80 curveto

    1 setlinecap 7 setlinewidth stroke

  }def

  /ucrotchet{cnh fill ustem}bind def
  /dcrotchet{cnh fill dstem}bind def
  /cnh{cnh fill}bind def
  /dquaver{cnh fill dstem dqtail} bind def
  /dsquaver{cnh fill dstem dsqtail} bind def
  /uquaver{cnh fill ustem uqtail} bind def
  /usquaver{cnh fill ustem usqtail} bind def
end % nCharacterDefs

ExtraCharacterDefs begin
  /bassclef{
    1500 0 setcharwidth
    -80 257 translate
    8.37 dup scale
    IntProcs begin
      %Path
      85 153 moveto
      109 152 120 131 121 113 curveto
      121 93 112 71 88 69 curveto
      68 69 59 79 59 91 curveto
      59 98 66 94 66 105 curveto
      66 110 64 117 56 116 curveto
      46 116 44 104 45 97 curveto
      48 78 69 63 88 64 curveto
      119 66 134 89 133 113 curveto
      134 149 112 162 85 162 curveto
      68 161 58 154 54 141 curveto
      52 138 53 130 54 131 curveto
      56 131 55 133 57 136 curveto
      61 145 66 155 85 153 curveto

      closepath fill

      %Path
      gsave
        0 -3 translate
        -2 2 random -2 2 random translate
        173 134 moveto
        169 131 164 129 160 132 curveto
        156 135 156 144 160 147 curveto
        164 151 169 149 173 146 curveto
        177 143 176 137 173 134 curveto
        closepath fill
      grestore

      %Path

      0 6 translate
      -2 2 random -2 2 random translate
      169 77 moveto
      167 74 161 73 159 76 curveto
      156 79 156 86 159 88 curveto
      162 92 168 91 171 89 curveto
      173 86 172 80 169 77 curveto

      closepath fill
    end
  }bind def

  /tfermata{
    0 0 setcharwidth
    IntProcs begin
      -780 -800 translate
      9 dup scale
      7.5 setlinewidth
      1 setlinecap
      gsave
        69 107 moveto
        78 119 87 140 121 140 curveto
        141 140 160 125 167 103 curveto
        [1 0 -0.2 0.2 random 1 0 0]concat
        stroke
      grestore
      -4 0 translate
      -2 2 random -2 2 random translate
      132 88 moveto
      127 83 119 83 114 88 curveto
      109 93 109 101 114 106 curveto
      119 111 127 111 132 106 curveto
      137 101 137 93 132 88 curveto
      fill
    end
  }bind def


  /leger{
    0 0 setcharwidth
    IntProcs begin -90 -30 20 random add 200 moveto 640 -20 30 random add 200 lineto end
    1 setlinecap
    50 setlinewidth true setstrokeadjust stroke
  }bind def

  /sharp{
    600 0 setcharwidth
    IntProcs begin
      /sharp_linel 700 def
      /sharp_sep 160 def
      250 200 translate
      -40 40 random -40 40 random translate
      [3 2 atan pop 4 3 atan dup neg]{
        40 setlinewidth
        gsave
          rotate
          sharp_linel 2 div neg -40 40 random add sharp_sep 2 div moveto
          sharp_linel -40 40 random add 0 rlineto stroke
          sharp_linel 2 div neg -40 40 random add sharp_sep 2 div neg moveto
          sharp_linel -40 40 random add 0 rlineto stroke
        grestore
      }forall
    end
  }bind def

  /uminim{
    650 0 setcharwidth
    % drawread mnh v -sc 15 -tr -280 -1070
    542 34 moveto
    470 -41 314 -44 233 30 curveto
    122 139 122 304 242 379 curveto
    332 442 422 424 506 352 curveto
    590 260 620 121 542 34 curveto
    closepath

    StemWidth 1.3 mul setlinewidth
    gsave
      [1 0 0 0.8 IntProcs begin random end 1 0 0]concat stroke
    grestore
    newpath

    600 250 moveto
    true setstrokeadjust
    1 setlinecap
    0 1200 Rl StemWidth setlinewidth stroke
  }bind def
  /dminim{
    650 0 setcharwidth
    % drawread mnh v -sc 15 -tr -280 -1070
    542 34 moveto
    470 -41 314 -44 233 30 curveto
    122 139 122 304 242 379 curveto
    332 442 422 424 506 352 curveto
    590 260 620 121 542 34 curveto
    closepath

    StemWidth 1.3 mul setlinewidth
    gsave
      [1 0 0 0.8 IntProcs begin random end 1 0 0]concat stroke
    grestore
    newpath

    590 200 moveto
    true setstrokeadjust
    1 setlinecap
    0 -1260 Rl StemWidth setlinewidth stroke
  }bind def


  /stave1{1000 0 setcharwidth 1000 stave}bind def
  /stave10{10000 0 setcharwidth 10000 stave}bind def

  /barsingle{
    600 0 setcharwidth
    IntProcs begin
      20 -20 -40 0 random add moveto
      20 1620 0 60 random dup 30 lt{pop 0}if add lineto
      80 setlinewidth true setstrokeadjust stroke
    end
  }bind def

  /bardouble{
    760 0 setcharwidth
    IntProcs begin
      gsave
      2{
        20 -20 moveto
        0 -0.8 0 random 2 copy rlineto neg rlineto
        0 1640 rlineto
        0 0.8 0 random rlineto
        200 setlinewidth true setstrokeadjust stroke
        300 0 translate
       }repeat
       grestore
       [
         [-280 600][-280 1000][610 600][610 1000]
       ]{
         gsave
           aload pop translate
           -20 20 random -20 20 random translate
           0 0 75 0 360 arc fill
         grestore
       }forall
     end
   }bind def
   /hdot{
     IntProcs begin
       400 0 setcharwidth
       -20 20 random -20 20 random  translate
       125 200 100 0 360 arc fill
     end
   }bind def

end


/BuildGlyph{
   exch begin % fontdict
     0 begin
       /charname exch def
       ExtraCharacterDefs charname 2 copy known{
         get exec}
         {pop pop
         nMetrics charname known{nMetrics}{Metrics}ifelse charname get
         nVMetrics charname known{
         nVMetrics charname get}
         {VMetrics charname known{
            VMetrics charname get}
              {0
            }ifelse
         }ifelse
         nBBox charname known{nBBox}{BBox}ifelse charname get
         exec setcachedevice
         nCharacterDefs charname known{nCharacterDefs}{CharacterDefs}ifelse
         charname get exec
       }ifelse
     end % fontdict
   end % BuildGlyph dict
}bind def

/BuildChar{
  1 index/Encoding get exch get
  1 index/BuildGlyph get exec
}bind def

/BuildGlyph load 2 3 dict put

currentdict dup/FontName get exch end definefont pop



